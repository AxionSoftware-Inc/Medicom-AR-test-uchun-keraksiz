<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Indoor Navigatsiya (Split)</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        
        /* Boshlang'ich Ekran */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center;
        }

        /* Asosiy UI */
        #nav-ui {
            position: fixed; bottom: 30px; left: 0; width: 100%;
            text-align: center; z-index: 1000; display: none;
        }

        .btn {
            background: #007AFF; color: white; border: none;
            padding: 15px 40px; font-size: 18px; font-weight: bold;
            border-radius: 30px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,122,255,0.4);
        }
        .btn:active { transform: scale(0.95); }

        #status-box {
            background: rgba(0,0,0,0.7); color: white; padding: 10px 20px;
            border-radius: 20px; display: inline-block; margin-bottom: 20px;
            font-size: 18px; font-weight: 600;
        }

        /* Kalibrovka Slayderi */
        #calibration-ui {
            position: fixed; top: 20px; right: 20px; z-index: 1001; display: none;
        }
        #calib-slider { width: 150px; cursor: pointer; }
        #calib-label { color: white; font-size: 12px; display: block; text-align: right; text-shadow: 1px 1px 2px black;}
    </style>
</head>

<body>

    <div id="start-screen">
        <h1 style="margin-bottom: 10px;">Indoor Nav üè¢</h1>
        <p style="color: #aaa; margin-bottom: 30px;">Telefonni yo'lakka to'g'irlang</p>
        <button class="btn" onclick="initApp()">BOSHLASH üöÄ</button>
    </div>

    <div id="nav-ui">
        <div id="status-box">Yuklanmoqda...</div>
        <br>
        <button class="btn" id="action-btn" onclick="nextStep()">Keldim ‚úÖ</button>
    </div>

    <div id="calibration-ui">
        <span id="calib-label">Burilishni to'g'irlash</span>
        <input type="range" id="calib-slider" min="-180" max="180" value="0" oninput="manualCalibrate(this.value)">
    </div>

    <video id="bg-video" autoplay playsinline muted 
           style="position: fixed; top: 0; left: 0; min-width: 100%; min-height: 100%; width: auto; height: auto; z-index: -1; object-fit: cover;"></video>

    <a-scene 
        vr-mode-ui="enabled: false" 
        renderer="logarithmicDepthBuffer: true;"
        loading-screen="dotsColor: white; backgroundColor: black">

        <a-entity id="camera-rig">
            <a-camera position="0 1.6 0" look-controls="enabled: true; touchEnabled: false;" wasd-controls="enabled: false"></a-camera>
        </a-entity>

        <a-entity id="world-root">
            
            <a-entity id="step-1">
                <a-circle position="0 0.1 0" rotation="-90 0 0" radius="0.4" color="red" opacity="0.5"></a-circle>
                <a-text value="START" position="0 1 0" align="center" color="red" look-at="[camera]"></a-text>

                <a-cone position="0 0.1 0.8" rotation="90 0 0" radius-bottom="0.05" height="0.2" color="#00ff00"></a-cone>
                <a-cone position="0 0.1 1.6" rotation="90 0 0" radius-bottom="0.05" height="0.2" color="#00ff00"></a-cone>
                
                <a-ring position="0 0.1 2.4" rotation="-90 0 0" radius-inner="0.3" radius-outer="0.4" color="yellow"></a-ring>
                <a-text value="ESHIK" position="0 1 2.4" align="center" color="yellow" look-at="[camera]"></a-text>
            </a-entity>

            <a-entity id="step-2" visible="false">
                <a-entity position="0 1 2.4" look-at="[camera]">
                    <a-text value="O'NGGA ->" color="#00ff00" align="center" scale="2 2 2"></a-text>
                </a-entity>

                <a-cone position="-0.8 0.1 2.4" rotation="90 0 90" radius-bottom="0.05" height="0.2" color="#00ff00"></a-cone>
                <a-cone position="-1.6 0.1 2.4" rotation="90 0 90" radius-bottom="0.05" height="0.2" color="#00ff00"></a-cone>
                <a-cone position="-2.4 0.1 2.4" rotation="90 0 90" radius-bottom="0.05" height="0.2" color="#00ff00"></a-cone>

                <a-box position="-3.2 0.5 2.4" color="blue" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
                <a-text value="MANZIL" position="-3.2 1.5 2.4" align="center" color="white" scale="2 2 2" look-at="[camera]"></a-text>
            </a-entity>

        </a-entity>
    </a-scene>

    <script src="app.js"></script>
</body>
</html>