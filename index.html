<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Navigatsiya (WebXR)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

    <style>
        body { font-family: sans-serif; }
        
        /* WebXR uchun Overlay (Tugmalar AR ustida chiqishi uchun) */
        #overlay {
            position: absolute; 
            z-index: 1000; 
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Bosishlarni o'tkazib yuborish */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 50px;
        }

        /* Tugma stillari */
        .ar-btn {
            pointer-events: auto; /* Tugmani bosish mumkin bo'lsin */
            background: rgba(40, 167, 69, 0.9);
            color: white;
            border: 2px solid white;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            margin-bottom: 20px;
            display: none; /* Boshida yashirin */
        }

        #start-btn {
            display: block; /* Boshlash tugmasi ko'rinib turadi */
            background: #007bff;
            margin-bottom: 50%;
        }

        #info-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: yellow;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 16px;
            pointer-events: none;
            text-align: center;
            width: 80%;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="info-box">AR sessiyasini boshlash uchun tugmani bosing</div>
        
        <button id="start-btn" class="ar-btn" onclick="startAR()">AR BOSHLASH ðŸš€</button>
        <button id="next-btn" class="ar-btn" onclick="nextStep()">Manzilga keldim (Keyingi) ðŸ‘‰</button>
        <button id="reset-btn" class="ar-btn" onclick="location.reload()" style="background: red; display: none;">Qayta boshlash ðŸ”„</button>
    </div>

    <a-scene 
        webxr="optionalFeatures: dom-overlay; overlayElement: #overlay;" 
        vr-mode-ui="enabled: false"
        renderer="colorManagement: true; physicallyCorrectLights: true;">

        <a-light type="ambient" intensity="1"></a-light>
        <a-light type="directional" position="1 1 1" intensity="1.5"></a-light>

        <a-entity id="world-root" position="0 0 0" rotation="0 180 0">
            
            <a-entity id="step-1">
                <a-box position="0 -1.5 0" color="red" scale="0.2 0.2 0.2"></a-box>
                <a-text value="START" position="0 -1.0 0" color="red" align="center" scale="1.5 1.5 1.5" look-at="[camera]"></a-text>

                <a-box position="0 -1.5 1" color="#ff4444" scale="0.1 0.1 0.1" opacity="0.8"></a-box>
                <a-box position="0 -1.5 2" color="#ff4444" scale="0.1 0.1 0.1" opacity="0.8"></a-box>
                <a-box position="0 -1.5 3" color="#ff4444" scale="0.1 0.1 0.1" opacity="0.8"></a-box>

                <a-cone position="0 -1.5 3.5" rotation="0 0 180" radius-bottom="0.1" height="0.3" color="yellow"></a-cone>
                <a-text value="Burilish" position="0 -1.0 3.5" color="yellow" align="center" scale="1.5 1.5 1.5" look-at="[camera]"></a-text>
            </a-entity>

            <a-entity id="step-2" visible="false">
                <a-sphere position="-1 -1.5 3.5" radius="0.1" color="green"></a-sphere>
                <a-sphere position="-2 -1.5 3.5" radius="0.1" color="green"></a-sphere>
                <a-sphere position="-3 -1.5 3.5" radius="0.1" color="green"></a-sphere>

                <a-box position="-3.5 -1.0 3.5" color="#00ff00" scale="0.4 0.4 0.4" 
                       animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>
                <a-text value="MANZIL" position="-3.5 -0.3 3.5" color="white" align="center" scale="2 2 2" look-at="[camera]"></a-text>
            </a-entity>

        </a-entity> <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    </a-scene>

    <script>
        let currentStep = 1;
        const scene = document.querySelector('a-scene');

        function startAR() {
            // WebXR sessiyasini boshlash (A-Frame avtomatik qiladi, biz faqat UI ni o'zgartiramiz)
            document.querySelector('a-scene').enterVR(); // enterVR bu aslida AR rejimini ham yoqadi (agar sozlangan bo'lsa)
            
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'block';
            document.getElementById('info-box').innerText = "Orqaga 180Â° buriling va qizil kublar bo'ylab yuring";
            
            // World rootni to'g'irlash (Start bosilganda 180 gradusga burib qo'yamiz, chunki siz 'orqaga' dedingiz)
            // Lekin WebXR da kamera pozitsiyasi startda 0,0,0 bo'ladi.
        }

        // WebXR sessiyasi boshlanganda event
        scene.addEventListener('enter-vr', function () {
            document.getElementById('info-box').innerText = "Kamera faollashdi. Atrofni skaner qiling.";
        });

        function nextStep() {
            if (currentStep === 1) {
                // 1-bosqich tugadi, 2-bosqichni yoqamiz
                document.getElementById('step-1').setAttribute('visible', 'false');
                document.getElementById('step-2').setAttribute('visible', 'true');
                
                document.getElementById('info-box').innerText = "Endi o'ngga qarab yuring (Yashil sharlar)";
                document.getElementById('next-btn').innerText = "Yetib keldim âœ…";
                currentStep = 2;
            } else {
                // Tugadi
                document.getElementById('info-box').innerText = "Tabriklaymiz! Manzildasiz.";
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('reset-btn').style.display = 'block';
            }
        }
    </script>
</body>
</html>