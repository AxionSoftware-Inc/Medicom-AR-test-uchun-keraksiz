<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fixed AR Camera</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: black; }
        #enter-ar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 12px 24px; border: 1px solid white; border-radius: 4px;
            background: rgba(0, 0, 0, 0.5); color: white; font-size: 16px;
            z-index: 999; cursor: pointer;
        }
    </style>
</head>
<body>

<button id="enter-ar">START AR (Fixed)</button>

<script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

    let camera, scene, renderer;
    let mesh;

    function init() {
        const container = document.createElement('div');
        document.body.appendChild(container);

        scene = new THREE.Scene();
        // ðŸš¨ 1-MUHIM: Sahna foni bo'sh (null) bo'lishi SHART, aks holda qora ekran bo'ladi
        scene.background = null; 

        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 3);
        light.position.set(0.5, 1, 0.25);
        scene.add(light);

        // ðŸš¨ 2-MUHIM: Renderer sozlamalari
        renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true, // Orqa fon shaffof bo'lishi uchun
            preserveDrawingBuffer: true // Ba'zi Androidlarda kerak bo'ladi
        });
        
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        // ðŸš¨ 3-MUHIM: Majburiy shaffoflikni o'rnatamiz
        renderer.setClearColor(0x000000, 0); // 0 = 100% shaffof
        
        renderer.xr.enabled = true;
        container.appendChild(renderer.domElement);

        // TEST MODEL (Yashil Kub)
        const geometry = new THREE.BoxGeometry(0.3, 0.3, 0.3);
        const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
        mesh = new THREE.Mesh(geometry, material);
        
        // 2 metr oldinda
        mesh.position.set(0, 0, -2);
        scene.add(mesh);

        document.getElementById('enter-ar').addEventListener('click', startAR);
    }

    async function startAR() {
        if (!navigator.xr) {
            alert("WebXR topilmadi (HTTPS va Chrome kerak)");
            return;
        }

        try {
            const session = await navigator.xr.requestSession('immersive-ar', {
                requiredFeatures: ['local'],
                optionalFeatures: ['dom-overlay'],
                domOverlay: { root: document.body } // UI ko'rinib turishi uchun
            });

            renderer.xr.setReferenceSpaceType('local');
            renderer.xr.setSession(session);

            document.getElementById('enter-ar').style.display = 'none';
            
            renderer.setAnimationLoop(render);
        } catch (e) {
            alert("Sessiya ochilmadi: " + e.message);
        }
    }

    function render() {
        // Kubni aylantirib turamiz (ishlayotganini bilish uchun)
        if(mesh) {
            mesh.rotation.x += 0.01;
            mesh.rotation.y += 0.01;
        }
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>

</body>
</html>